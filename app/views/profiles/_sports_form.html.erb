<div class="sports-form">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="mb-0">Sports & Skills</h6>
    <button type="button" class="btn btn-outline-primary btn-sm" id="add-sport">
      <i class="fas fa-plus me-2"></i>Add Sport
    </button>
  </div>
  
  <div id="sports-container">
    <% if user_sports.any? %>
      <% user_sports.each_with_index do |user_sport, index| %>
        <div class="sport-entry card mb-3" data-index="<%= index %>">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h6 class="card-title mb-0">Sport <%= index + 1 %></h6>
              <button type="button" class="btn btn-outline-danger btn-sm remove-sport">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="form-floating">
                  <select name="sports[<%= index %>][sport_id]" class="form-select" required>
                    <option value="">Select Sport</option>
                    <% sports.each do |sport| %>
                      <option value="<%= sport.id %>" <%= 'selected' if user_sport.sport_id == sport.id %>>
                        <%= sport.name %>
                      </option>
                    <% end %>
                  </select>
                  <label>Sport</label>
                </div>
              </div>
              
              <div class="col-md-6 mb-3">
                <div class="form-floating">
                  <input type="text" name="sports[<%= index %>][position]" class="form-control" 
                         placeholder="Position" value="<%= user_sport.position %>">
                  <label>Position (e.g., Forward, Midfielder)</label>
                </div>
              </div>
              
              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <select name="sports[<%= index %>][skill_level]" class="form-select" required>
                    <option value="">Skill Level</option>
                    <option value="beginner" <%= 'selected' if user_sport.skill_level == 'beginner' %>>Beginner</option>
                    <option value="intermediate" <%= 'selected' if user_sport.skill_level == 'intermediate' %>>Intermediate</option>
                    <option value="advanced" <%= 'selected' if user_sport.skill_level == 'advanced' %>>Advanced</option>
                    <option value="expert" <%= 'selected' if user_sport.skill_level == 'expert' %>>Expert</option>
                  </select>
                  <label>Skill Level</label>
                </div>
              </div>
              
              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input type="number" name="sports[<%= index %>][years_experience]" class="form-control" 
                         placeholder="Years" min="0" max="50" value="<%= user_sport.years_experience %>">
                  <label>Years Experience</label>
                </div>
              </div>
              
              <div class="col-md-4 mb-3">
                <div class="form-check form-switch mt-3">
                  <input type="hidden" name="sports[<%= index %>][primary]" value="0">
                  <input class="form-check-input" type="checkbox" name="sports[<%= index %>][primary]" 
                         value="1" id="primary_<%= index %>" <%= 'checked' if user_sport.primary? %>>
                  <label class="form-check-label" for="primary_<%= index %>">
                    Primary Sport
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <!-- Empty state - will be populated by JavaScript -->
    <% end %>
  </div>
  
  <div class="text-muted small">
    <i class="fas fa-info-circle me-2"></i>
    Add the sports you play and your skill level. Mark your primary sport to highlight your main focus.
  </div>
</div>

<!-- Template for new sport entries -->
<template id="sport-entry-template">
  <div class="sport-entry card mb-3" data-index="">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <h6 class="card-title mb-0">Sport</h6>
        <button type="button" class="btn btn-outline-danger btn-sm remove-sport">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <select name="sports[][sport_id]" class="form-select" required>
              <option value="">Select Sport</option>
              <% sports.each do |sport| %>
                <option value="<%= sport.id %>"><%= sport.name %></option>
              <% end %>
            </select>
            <label>Sport</label>
          </div>
        </div>
        
        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <input type="text" name="sports[][position]" class="form-control" placeholder="Position">
            <label>Position (e.g., Forward, Midfielder)</label>
          </div>
        </div>
        
        <div class="col-md-4 mb-3">
          <div class="form-floating">
            <select name="sports[][skill_level]" class="form-select" required>
              <option value="">Skill Level</option>
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
              <option value="expert">Expert</option>
            </select>
            <label>Skill Level</label>
          </div>
        </div>
        
        <div class="col-md-4 mb-3">
          <div class="form-floating">
            <input type="number" name="sports[][years_experience]" class="form-control" 
                   placeholder="Years" min="0" max="50">
            <label>Years Experience</label>
          </div>
        </div>
        
        <div class="col-md-4 mb-3">
          <div class="form-check form-switch mt-3">
            <input type="hidden" name="sports[][primary]" value="0">
            <input class="form-check-input" type="checkbox" name="sports[][primary]" value="1">
            <label class="form-check-label">Primary Sport</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const addSportBtn = document.getElementById('add-sport');
  const sportsContainer = document.getElementById('sports-container');
  const template = document.getElementById('sport-entry-template');
  let sportIndex = <%= user_sports.count %>;
  
  // Add new sport entry
  addSportBtn.addEventListener('click', function() {
    const newEntry = template.content.cloneNode(true);
    const sportEntry = newEntry.querySelector('.sport-entry');
    
    // Update indices
    sportEntry.setAttribute('data-index', sportIndex);
    sportEntry.querySelector('.card-title').textContent = `Sport ${sportIndex + 1}`;
    
    // Update form names with current index
    const inputs = sportEntry.querySelectorAll('input, select');
    inputs.forEach(input => {
      const name = input.getAttribute('name');
      if (name) {
        input.setAttribute('name', name.replace('[]', `[${sportIndex}]`));
      }
      if (input.type === 'checkbox') {
        input.id = `primary_${sportIndex}`;
        const label = sportEntry.querySelector(`label[for="${input.id}"]`);
        if (label) label.setAttribute('for', input.id);
      }
    });
    
    sportsContainer.appendChild(newEntry);
    sportIndex++;
  });
  
  // Remove sport entry
  sportsContainer.addEventListener('click', function(e) {
    if (e.target.closest('.remove-sport')) {
      e.target.closest('.sport-entry').remove();
      updateSportTitles();
    }
  });
  
  function updateSportTitles() {
    const sportEntries = sportsContainer.querySelectorAll('.sport-entry');
    sportEntries.forEach((entry, index) => {
      entry.querySelector('.card-title').textContent = `Sport ${index + 1}`;
    });
  }
  
  // Ensure only one primary sport
  sportsContainer.addEventListener('change', function(e) {
    if (e.target.name && e.target.name.includes('[primary]') && e.target.checked) {
      const allPrimaryCheckboxes = sportsContainer.querySelectorAll('input[type="checkbox"][name*="[primary]"]');
      allPrimaryCheckboxes.forEach(checkbox => {
        if (checkbox !== e.target) {
          checkbox.checked = false;
        }
      });
    }
  });
  
  // Add first sport if none exist
  if (sportIndex === 0) {
    addSportBtn.click();
  }
});
</script>